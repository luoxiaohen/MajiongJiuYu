{"version":3,"sources":["assets\\Script\\com\\ObjectPool.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { Global } from \"../Shared/GloBal\";\r\n\r\n/**\r\n * 对象池接口\r\n */\r\nexport interface IObjectPool {\r\n\t/**在获取时调用 */\r\n\tobjectInit(_params?: any);\r\n\t/**在放回池子里面时调用 */\r\n\tobjectReset();\r\n}\r\n/**\r\n * 对象池类\r\n */\r\nexport class ObjectPool {\r\n\tprivate mGroupMode: boolean;\r\n\tprivate mObjectMap: Object = {};\r\n\tprivate mObjectClassMap: Object = {};\r\n\tprivate mCurClassKey: string = null;\r\n\t/**[public] \r\n\t * \r\n\t * @param _groupMode 组模式 \r\n\t */\r\n\tpublic constructor(_groupMode: boolean = false) {\r\n\t\tthis.mGroupMode = _groupMode;\r\n\t}\r\n\tprivate getSaveKey(_class: any) {\r\n\t\treturn cc.js.getClassName(_class);\r\n\t}\r\n\t/**[public] \r\n\t * 注册对象 以类注册 如果在此对象池初始化时 设置的是组模式 那么_objectType不可为空\r\n\t * 如果是非组模式 则可设置为空\r\n\t * @param _class \r\n\t * @param _objectType \r\n\t */\r\n\tpublic regObject(_class: any, _objectType: any = null) {\r\n\t\tif (!this.mGroupMode && this.mCurClassKey) {\r\n\t\t\treturn;\r\n\t\t} else if (this.mGroupMode && (_objectType == null)) {\r\n\t\t\tGlobal.Utils.debugOutput(`${this.getSaveKey(_class)} 's type not null`)\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!this.mGroupMode && (_objectType == null)) {\r\n\t\t\tthis.mCurClassKey = this.getSaveKey(_class);\r\n\t\t}\r\n\t\tlet _classKey = _objectType != null ? _objectType : this.mCurClassKey;\r\n\t\tthis.mObjectClassMap[_classKey] = _class;\r\n\t}\r\n\t/**\r\n\t * 是否注册过某个类\r\n\t */\r\n\tpublic hasReg(_objectType: any): boolean {\r\n\t\treturn this.getObjectClz(_objectType) != undefined;\r\n\t}\r\n\tpublic getObjectClz(_objectType: any): any {\r\n\t\treturn this.mObjectClassMap[_objectType];\r\n\t}\r\n\t/**[public] \r\n\t * 取得对象\r\n\t * @param _objectType \r\n\t */\r\n\tpublic getObject(_params: any = null, _objectType: any = null): any {\r\n\t\t_objectType = this.mCurClassKey ? this.mCurClassKey : _objectType;\r\n\t\tif (_objectType == null) {\r\n\t\t\tGlobal.Utils.debugOutput(\"_objectType can not null\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!this.hasReg(_objectType)) {\r\n\t\t\tGlobal.Utils.debugOutput(`objectType = ${_objectType} not regist`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet _instanceList: IObjectPool[] = this.getObjectList(_objectType);\r\n\t\tlet _iObjectPool: IObjectPool = null;\r\n\t\tif (_instanceList.length) {\r\n\t\t\t_iObjectPool = _instanceList.pop();\r\n\t\t} else {\r\n\t\t\t_iObjectPool = new this.mObjectClassMap[_objectType]();\r\n\t\t\t_iObjectPool[\"objectType\"] = _objectType;\r\n\t\t}\r\n\t\tif (_iObjectPool.objectInit.length) {\r\n\t\t\t_iObjectPool.objectInit(_params);\r\n\t\t} else {\r\n\t\t\t_iObjectPool.objectInit();\r\n\t\t}\r\n\r\n\t\treturn _iObjectPool;\r\n\t}\r\n\t/**[public] \r\n\t * 放回\r\n\t * @param _iObjectPool \r\n\t */\r\n\tpublic putObject(_iObjectPool: IObjectPool) {\r\n\t\tif (!_iObjectPool) return;\r\n\t\tlet _objectType = _iObjectPool[\"objectType\"];\r\n\t\tif (_objectType == undefined || _objectType == null) {\r\n\t\t\tfor (let _key in this.mObjectClassMap) {\r\n\t\t\t\tlet _objectClass: any = this.mObjectClassMap[_key];\r\n\t\t\t\tif (_iObjectPool instanceof _objectClass) {\r\n\t\t\t\t\t_objectType = _key;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (_objectType != undefined || _objectType != null) {\r\n\t\t\tlet _instanceList: IObjectPool[] = this.getObjectList(_objectType);\r\n\t\t\t_iObjectPool.objectReset();\r\n\t\t\t_instanceList.unshift(_iObjectPool);\r\n\t\t} else {\r\n\t\t\tGlobal.Utils.debugOutput(`${this.getSaveKey(_iObjectPool)} not exist`);\r\n\t\t}\r\n\t}\r\n\t/**[public] \r\n\t * 批量放回\r\n\t * @param _iObjectPools \r\n\t */\r\n\tpublic putObjects(_iObjectPools: IObjectPool[]) {\r\n\t\t_iObjectPools.forEach((value) => {\r\n\t\t\tthis.putObject(value);\r\n\t\t})\r\n\t}\r\n\t/**\r\n\t * 清空\r\n\t * _objectType 类型 默认清空所有\r\n\t */\r\n\tpublic clearObject(_objectType: any = null) {\r\n\t\t_objectType = this.mCurClassKey ? this.mCurClassKey : _objectType;\r\n\t\tif (_objectType) {\r\n\t\t\tdelete this.mObjectMap[_objectType];\r\n\t\t\tdelete this.mObjectClassMap[_objectType];\r\n\t\t} else {\r\n\t\t\tthis.mObjectMap = {};\r\n\t\t\tthis.mObjectClassMap = {};\r\n\t\t}\r\n\t}\r\n\tpublic getObjectList(_objectType: any): IObjectPool[] {\r\n\t\tlet _tempList: IObjectPool[] = this.mObjectMap[_objectType];\r\n\t\tif (!_tempList) {\r\n\t\t\t_tempList = [];\r\n\t\t\tthis.mObjectMap[_objectType] = _tempList;\r\n\t\t}\r\n\t\treturn _tempList;\r\n\t}\r\n}"]}